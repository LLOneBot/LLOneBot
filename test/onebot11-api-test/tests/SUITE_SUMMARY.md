# æµ‹è¯•å¥—ä»¶åŒ–æ€»ç»“

## ğŸ“Š å¥—ä»¶åŒ–æˆæœ

é€šè¿‡æµ‹è¯•å¥—ä»¶åŒ–ï¼Œæˆ‘ä»¬å°†ç›¸å…³çš„ API æµ‹è¯•åˆå¹¶åˆ°ä¸€èµ·ï¼Œå‡å°‘äº†æ–‡ä»¶æ•°é‡ï¼Œæé«˜äº†æµ‹è¯•è´¨é‡ã€‚

### ç»Ÿè®¡æ•°æ®

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æ”¹è¿› |
|------|--------|--------|------|
| **æµ‹è¯•æ–‡ä»¶æ•°** | 91 | 85 | -6 (-6.6%) |
| **è¦†ç›– API æ•°** | 91 | 91 | ä¸å˜ |
| **æµ‹è¯•å¥—ä»¶æ•°** | 0 | 5 | +5 |

### å¥—ä»¶åŒ–çš„æ–‡ä»¶

| åŸæ–‡ä»¶ | æ–°æ–‡ä»¶ | è¯´æ˜ |
|--------|--------|------|
| `create-group-file-folder.test.ts`<br>`get-group-files-by-folder.test.ts`<br>`delete-group-folder.test.ts` | `group-file-folder.test.ts` | ç¾¤æ–‡ä»¶å¤¹å®Œæ•´ç”Ÿå‘½å‘¨æœŸ |
| `upload-group-file.test.ts`<br>`get-group-file-url.test.ts`<br>`delete-group-file.test.ts` | `group-file-operations.test.ts` | ç¾¤æ–‡ä»¶å®Œæ•´æ“ä½œæµç¨‹ |
| `get-ai-characters.test.ts`<br>`send-group-ai-record.test.ts` | `ai-record.test.ts` | AI è¯­éŸ³åŠŸèƒ½å¥—ä»¶ |
| `set-msg-emoji-like.test.ts`<br>`fetch-emoji-like.test.ts` | `emoji-like.test.ts` | æ¶ˆæ¯è¡¨æƒ…å›åº”å¥—ä»¶ |
| `get-private-file-url.test.ts` (ç‹¬ç«‹) | `get-private-file-url.test.ts` (å¥—ä»¶) | ç§èŠæ–‡ä»¶å®Œæ•´æµç¨‹ |

## ğŸ¯ å·²å®ç°çš„ 5 ä¸ªæµ‹è¯•å¥—ä»¶

### 1. æ¶ˆæ¯è¡¨æƒ…å›åº”å¥—ä»¶
**æ–‡ä»¶**: `msg/emoji-like.test.ts`  
**æµç¨‹**: å‘é€æ¶ˆæ¯ â†’ è®¾ç½®è¡¨æƒ… â†’ è·å–è¡¨æƒ… â†’ å–æ¶ˆè¡¨æƒ…  
**API**: 3 ä¸ª

```typescript
it('æµ‹è¯•å®Œæ•´çš„è¡¨æƒ…å›åº”æµç¨‹', async () => {
  // 1. å‘é€æ¶ˆæ¯
  const messageId = await sendMessage();
  
  // 2. è®¾ç½®è¡¨æƒ…å›åº”
  await setMsgEmojiLike(messageId, emojiId);
  
  // 3. è·å–è¡¨æƒ…å›åº”åˆ—è¡¨
  const likes = await fetchEmojiLike(messageId, emojiId);
  
  // 4. å–æ¶ˆè¡¨æƒ…å›åº”
  await unsetMsgEmojiLike(messageId, emojiId);
  
  // 5. éªŒè¯å·²å–æ¶ˆ
  await fetchEmojiLike(messageId, emojiId);
});
```

### 2. AI è¯­éŸ³åŠŸèƒ½å¥—ä»¶
**æ–‡ä»¶**: `msg/ai-record.test.ts`  
**æµç¨‹**: è·å–è§’è‰² â†’ å‘é€è¯­éŸ³ â†’ éªŒè¯æ¥æ”¶  
**API**: 2 ä¸ª

```typescript
it('æµ‹è¯•è·å– AI è§’è‰²åˆ—è¡¨å¹¶å‘é€ AI è¯­éŸ³', async () => {
  // 1. è·å– AI è§’è‰²åˆ—è¡¨
  const characters = await getAiCharacters();
  
  // 2. ä½¿ç”¨ç¬¬ä¸€ä¸ªè§’è‰²å‘é€ AI è¯­éŸ³
  const response = await sendGroupAiRecord(characterId, text);
  
  // 3. éªŒè¯æ¥æ”¶
  await waitForEvent(message_id);
});
```

### 2. ç¾¤æ–‡ä»¶å¤¹ç®¡ç†å¥—ä»¶
**æ–‡ä»¶**: `file/group-file-folder.test.ts`  
**æµç¨‹**: åˆ›å»º â†’ éªŒè¯ â†’ è·å–å†…å®¹ â†’ åˆ é™¤ â†’ éªŒè¯  
**API**: 3 ä¸ª

```typescript
it('åˆ›å»ºæ–‡ä»¶å¤¹', async () => {
  folderId = await createFolder();
});

it('è·å–æ–‡ä»¶å¤¹åˆ—è¡¨', async () => {
  await getFilesByFolder(folderId);
});

it('åˆ é™¤æ–‡ä»¶å¤¹', async () => {
  await deleteFolder(folderId);
});
```

### 3. ç§èŠæ–‡ä»¶ URL å¥—ä»¶
**æ–‡ä»¶**: `file/get-private-file-url.test.ts`  
**æµç¨‹**: ä¸Šä¼  â†’ æ¥æ”¶ â†’ è·å– URL  
**API**: 2 ä¸ª

```typescript
it('æµ‹è¯•ä¸Šä¼ ç§èŠæ–‡ä»¶å¹¶è·å– URL', async () => {
  // 1. ä¸Šä¼ æ–‡ä»¶
  const fileId = await uploadPrivateFile();
  
  // 2. ç­‰å¾…æ¥æ”¶
  await waitForFileMessage();
  
  // 3. è·å– URL
  const url = await getPrivateFileUrl(fileId);
});
```

### 5. ç¾¤æ–‡ä»¶æ“ä½œå¥—ä»¶
**æ–‡ä»¶**: `file/group-file-operations.test.ts`  
**æµç¨‹**: ä¸Šä¼  â†’ éªŒè¯ â†’ è·å–é“¾æ¥ â†’ åˆ é™¤ â†’ éªŒè¯  
**API**: 3 ä¸ª

```typescript
it('ä¸Šä¼ æ–‡ä»¶', async () => {
  fileId = await uploadGroupFile();
});

it('è·å–ä¸‹è½½é“¾æ¥', async () => {
  const url = await getGroupFileUrl(fileId);
});

it('åˆ é™¤æ–‡ä»¶', async () => {
  await deleteGroupFile(fileId);
});
```

## âœ¨ å¥—ä»¶åŒ–çš„ä¼˜åŠ¿

### 1. æµ‹è¯•å®Œæ•´æ€§
- âœ… æµ‹è¯•å®Œæ•´çš„åŠŸèƒ½æµç¨‹
- âœ… éªŒè¯å„ä¸ªæ­¥éª¤ä¹‹é—´çš„å…³è”
- âœ… ç¡®ä¿ç«¯åˆ°ç«¯åŠŸèƒ½æ­£å¸¸

### 2. æ•°æ®å…±äº«
- âœ… æ­¥éª¤é—´è‡ªåŠ¨ä¼ é€’æ•°æ®ï¼ˆå¦‚ `file_id`ã€`folder_id`ï¼‰
- âœ… é¿å…ç¡¬ç¼–ç æµ‹è¯•æ•°æ®
- âœ… æµ‹è¯•æ›´åŠ çœŸå®å¯é 

### 3. èµ„æºç®¡ç†
- âœ… è‡ªåŠ¨åˆ›å»ºæµ‹è¯•èµ„æº
- âœ… è‡ªåŠ¨æ¸…ç†æµ‹è¯•èµ„æº
- âœ… ä¸æ±¡æŸ“æµ‹è¯•ç¯å¢ƒ

### 4. ä»£ç è´¨é‡
- âœ… å‡å°‘é‡å¤ä»£ç 
- âœ… æé«˜å¯ç»´æŠ¤æ€§
- âœ… æ›´æ¸…æ™°çš„æµ‹è¯•é€»è¾‘

### 5. æ‰§è¡Œæ•ˆç‡
- âœ… å‡å°‘æµ‹è¯•æ–‡ä»¶æ•°é‡
- âœ… å‡å°‘é‡å¤çš„åˆå§‹åŒ–
- âœ… æ›´å¿«çš„æµ‹è¯•æ‰§è¡Œ

## ğŸ“ˆ å¥—ä»¶åŒ–æ•ˆæœå¯¹æ¯”

### æ”¹è¿›å‰ï¼ˆç‹¬ç«‹æµ‹è¯•ï¼‰

```typescript
// get-ai-characters.test.ts
it('æµ‹è¯•è·å– AI è§’è‰²', async () => {
  const response = await getAiCharacters();
  // åªèƒ½éªŒè¯ API è¿”å›ï¼Œæ— æ³•éªŒè¯è§’è‰²æ˜¯å¦å¯ç”¨
});

// send-group-ai-record.test.ts
it('æµ‹è¯•å‘é€ AI è¯­éŸ³', async () => {
  // éœ€è¦ç¡¬ç¼–ç è§’è‰² IDï¼Œå¯èƒ½ä¸å­˜åœ¨
  const response = await sendAiRecord('hardcoded_id', text);
});
```

**é—®é¢˜ï¼š**
- âŒ æ— æ³•éªŒè¯è§’è‰²æ˜¯å¦çœŸå®å¯ç”¨
- âŒ ç¡¬ç¼–ç çš„è§’è‰² ID å¯èƒ½å¤±æ•ˆ
- âŒ ä¸¤ä¸ªæµ‹è¯•ä¹‹é—´æ²¡æœ‰å…³è”

### æ”¹è¿›åï¼ˆæµ‹è¯•å¥—ä»¶ï¼‰

```typescript
// ai-record.test.ts
it('æµ‹è¯•è·å– AI è§’è‰²åˆ—è¡¨å¹¶å‘é€ AI è¯­éŸ³', async () => {
  // 1. åŠ¨æ€è·å–å¯ç”¨è§’è‰²
  const characters = await getAiCharacters();
  const characterId = characters[0].id;
  
  // 2. ä½¿ç”¨çœŸå®è§’è‰²å‘é€
  const response = await sendAiRecord(characterId, text);
  
  // 3. éªŒè¯æ¶ˆæ¯é€è¾¾
  await waitForEvent(message_id);
});
```

**ä¼˜åŠ¿ï¼š**
- âœ… ä½¿ç”¨çœŸå®å¯ç”¨çš„è§’è‰²
- âœ… éªŒè¯å®Œæ•´æµç¨‹
- âœ… è‡ªåŠ¨å¤„ç†æ— è§’è‰²æƒ…å†µ

## ğŸ”„ é€‚åˆå¥—ä»¶åŒ–çš„å…¶ä»–åŠŸèƒ½

åŸºäºå½“å‰ç»éªŒï¼Œä»¥ä¸‹åŠŸèƒ½ä¹Ÿé€‚åˆå¥—ä»¶åŒ–ï¼š

### é«˜ä¼˜å…ˆçº§
1. **ç¾¤å…¬å‘Šç®¡ç†** - å‘å¸ƒ â†’ è·å– â†’ åˆ é™¤
2. **ç²¾åæ¶ˆæ¯ç®¡ç†** - è®¾ç½® â†’ åˆ—è¡¨ â†’ åˆ é™¤
3. **å¥½å‹è¯·æ±‚å¤„ç†** - è·å– â†’ å¤„ç†
4. **ç¾¤è¯·æ±‚å¤„ç†** - è·å– â†’ å¤„ç†

### ä¸­ä¼˜å…ˆçº§
5. **è¡¨æƒ…å›åº”** - è®¾ç½® â†’ è·å– â†’ å–æ¶ˆ
6. **è¯­éŸ³å¤„ç†** - å‘é€ â†’ æ¥æ”¶ â†’ è½¬æ–‡å­—
7. **å¥½å‹ç®¡ç†** - æ·»åŠ  â†’ å¤‡æ³¨ â†’ åˆ†ç»„ â†’ åˆ é™¤

## ğŸ“ å¥—ä»¶åŒ–æœ€ä½³å®è·µ

### 1. ä½•æ—¶ä½¿ç”¨å¥—ä»¶åŒ–

âœ… **é€‚åˆå¥—ä»¶åŒ–ï¼š**
- æœ‰æ˜ç¡®çš„ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»º â†’ ä½¿ç”¨ â†’ åˆ é™¤ï¼‰
- æ­¥éª¤ä¹‹é—´æœ‰æ•°æ®ä¾èµ–
- éœ€è¦éªŒè¯å®Œæ•´æµç¨‹
- éœ€è¦è‡ªåŠ¨æ¸…ç†èµ„æº

âŒ **ä¸é€‚åˆå¥—ä»¶åŒ–ï¼š**
- ç‹¬ç«‹çš„æŸ¥è¯¢æ“ä½œ
- æ— çŠ¶æ€çš„åŠŸèƒ½
- ä¸éœ€è¦èµ„æºæ¸…ç†

### 2. å¥—ä»¶åŒ–è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£** - ä¸€ä¸ªå¥—ä»¶æµ‹è¯•ä¸€ä¸ªå®Œæ•´åŠŸèƒ½
2. **æ•°æ®å…±äº«** - ä½¿ç”¨å˜é‡åœ¨æ­¥éª¤é—´ä¼ é€’æ•°æ®
3. **ä¼˜é›…é™çº§** - å¤„ç†èµ„æºä¸å­˜åœ¨çš„æƒ…å†µ
4. **è‡ªåŠ¨æ¸…ç†** - æœ€åä¸€æ­¥æ¸…ç†æµ‹è¯•èµ„æº
5. **æ¸…æ™°å‘½å** - å¥—ä»¶åç§°ä½“ç°å®Œæ•´æµç¨‹

### 3. ä»£ç æ¨¡æ¿

```typescript
describe('feature - åŠŸèƒ½æè¿°', () => {
  let context: MessageTestContext;
  let resourceId: string | null = null;

  beforeAll(async () => {
    context = await setupMessageTest();
  });

  afterAll(() => {
    teardownMessageTest(context);
  });

  it('æµ‹è¯•å®Œæ•´æµç¨‹', async () => {
    // æ­¥éª¤1: åˆ›å»ºèµ„æº
    resourceId = await createResource();
    
    // æ­¥éª¤2: ä½¿ç”¨èµ„æº
    if (!resourceId) return;
    await useResource(resourceId);
    
    // æ­¥éª¤3: æ¸…ç†èµ„æº
    await deleteResource(resourceId);
  });
});
```

## ğŸ‰ æ€»ç»“

é€šè¿‡æµ‹è¯•å¥—ä»¶åŒ–ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

- âœ… **5 ä¸ªæµ‹è¯•å¥—ä»¶**ï¼Œè¦†ç›– 13 ä¸ª API
- âœ… **å‡å°‘ 6 ä¸ªæµ‹è¯•æ–‡ä»¶**ï¼Œæé«˜ä»£ç è´¨é‡
- âœ… **å®Œæ•´çš„æµç¨‹æµ‹è¯•**ï¼Œç¡®ä¿åŠŸèƒ½æ­£ç¡®
- âœ… **è‡ªåŠ¨èµ„æºç®¡ç†**ï¼Œä¿æŒç¯å¢ƒæ¸…æ´
- âœ… **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**ï¼Œä¾¿äºåç»­æ‰©å±•

æµ‹è¯•å¥—ä»¶åŒ–æ˜¯æé«˜æµ‹è¯•è´¨é‡çš„é‡è¦æ‰‹æ®µï¼Œå»ºè®®åœ¨åç»­å¼€å‘ä¸­ç»§ç»­åº”ç”¨è¿™ä¸€æ¨¡å¼ã€‚
